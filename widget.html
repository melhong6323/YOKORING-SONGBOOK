<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>YOKORING Song Widget - Platinum Silver</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root {
            /* 1. í•‘í¬ê°€ ë‹ë³´ì´ë„ë¡ ì±„ë„ë¥¼ ì‚´ì§ ë†’ì¸ í•‘í¬ */
            --pink-accent: #ff8ab4; 
            /* 2. ê³ ê¸‰ì§„ ì€ìƒ‰ ëŠë‚Œì„ ì£¼ëŠ” í”Œë˜í‹°ë„˜ ì‹¤ë²„ ë°°ê²½ (ë†ë„ ìµœì í™”) */
            --silver-bg: rgba(210, 215, 225, 0.4); 
            --border-light: rgba(255, 255, 255, 0.7); /* ë¹› ë°˜ì‚¬ íš¨ê³¼ */
            /* 3. ëª…ë„ ëŒ€ë¹„ë¥¼ ê·¹ëŒ€í™”í•œ ê¸€ììƒ‰ */
            --text-main: #1a1c20; /* ì œëª©: ì•„ì£¼ ì§„í•œ ìˆ¯ìƒ‰ */
            --text-sub: #444952;  /* ê°€ìˆ˜: ê°€ë…ì„±ì„ ë†’ì¸ ì§„í•œ íšŒìƒ‰ */
        }

        body {
            margin: 0; background: transparent; font-family: 'Pretendard', sans-serif;
            display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden;
        }

        #widget-card {
            display: flex; align-items: center; width: 400px; height: 84px; padding: 0 16px;
            background: var(--silver-bg); 
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 42px; 
            /* í…Œë‘ë¦¬: ìœ„ìª½ì€ ë°ê²Œ, ì•„ë˜ìª½ì€ ì–´ë‘¡ê²Œ í•˜ì—¬ 'ë–  ìˆëŠ” ê¸ˆì†' ëŠë‚Œ êµ¬í˜„ */
            border: 1px solid var(--border-light);
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
            /* ê·¸ë¦¼ì: ë°°ê²½ì—ì„œ íˆ­ íŠ€ì–´ë‚˜ì™€ ë³´ì´ê²Œ í•˜ëŠ” ë”¥ ì„€ë„ìš° */
            box-shadow: 
                0 12px 30px rgba(0, 0, 0, 0.2),
                0 4px 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
            opacity: 1;
        }

        .app-icon-area {
            flex-shrink: 0; width: 52px; height: 52px;
            /* ì•„ì´ì½˜ ë°°ê²½ì„ ë§¤ëˆí•œ í™”ì´íŠ¸-ì‹¤ë²„ ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ */
            background: linear-gradient(135deg, #ffffff 0%, #e8ecf3 100%);
            border-radius: 15px; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); margin-right: 12px;
        }
        .app-icon-area img { width: 85%; height: 85%; object-fit: contain; }

        .info-area { flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; margin-right: 10px; }
        
        /* ìƒíƒœ ë°°ì§€ì—ë„ ë¯¸ì„¸í•œ í›„ê´‘ ì¶”ê°€ */
        .status-badge { 
            font-size: 9px; font-weight: 900; color: var(--pink-accent); 
            letter-spacing: 0.8px; margin-bottom: 1px;
            text-shadow: 0 0 8px rgba(255, 138, 180, 0.3);
        }

        .title-container { width: 100%; overflow: hidden; white-space: nowrap; position: relative; }
        
        /* ë…¸ë˜ ì œëª©: ë¶ˆíˆ¬ëª…í•˜ê³  ë‚ ì¹´ë¡œìš´ ëª…ë„ ëŒ€ë¹„ */
        .song-title { 
            margin: 0; font-size: 18px; font-weight: 800; color: var(--text-main); 
            display: inline-block; letter-spacing: -0.3px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8); /* ê¸€ì ë’¤ í™”ì´íŠ¸ í›„ê´‘ */
        }

        .marquee { animation: marquee 10s linear infinite; padding-left: 40px; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* ê°€ìˆ˜ ì´ë¦„: ê°€ë…ì„± ëŒ€í­ ê°•í™” */
        .artist-name { 
            margin: 1px 0 0 0; font-size: 12px; font-weight: 600; color: var(--text-sub);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.5); 
        }

        .right-controls { flex-shrink: 0; display: flex; align-items: center; gap: 10px; }
        .playback-btns { display: flex; align-items: center; gap: 7px; color: var(--text-sub); }
        .btn-icon { font-size: 12px; opacity: 0.5; }
        .btn-play-circle {
            width: 32px; height: 32px; border-radius: 50%; background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-light); display: flex; justify-content: center; align-items: center;
            font-size: 11px; color: var(--pink-accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* í•‘í¬ìƒ‰ ë¹„ì£¼ì–¼ë¼ì´ì € */
        .visualizer { display: flex; align-items: flex-end; gap: 3px; height: 18px; padding-bottom: 2px; }
        .bar { width: 3.5px; background: var(--pink-accent); border-radius: 2px; animation: visualize 0.6s ease-in-out infinite alternate; }
        .bar:nth-child(1) { animation-delay: 0.0s; height: 30%; }
        .bar:nth-child(2) { animation-delay: 0.1s; height: 100%; }
        .bar:nth-child(3) { animation-delay: 0.2s; height: 60%; }

        @keyframes visualize { 0% { height: 4px; opacity: 0.6; } 100% { height: 18px; opacity: 1; } }

        #widget-card.standby { opacity: 0.8; filter: saturate(0.7); transform: scale(0.98); }
        #widget-card.standby .bar { animation: none; height: 4px; opacity: 0.3; }
    </style>
</head>
<body>
    <div id="widget-card" class="standby">
        <div class="app-icon-area"><img src="KoringSign.png" alt="App Logo"></div>
        <div class="info-area">
            <div class="status-badge" id="status">READY</div>
            <div class="title-container"><h1 class="song-title" id="title">ìš”ì½”ë§ ë…¸ë˜ì±…</h1></div>
            <p class="artist-name" id="artist">YOKORING Player</p>
        </div>
        <div class="right-controls">
            <div class="playback-btns">
                <i class="fa-solid fa-backward-step btn-icon"></i>
                <div class="btn-play-circle"><i class="fa-solid fa-play"></i></div>
                <i class="fa-solid fa-forward-step btn-icon"></i>
            </div>
            <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        </div>
    </div>

    <script>
        const card = document.getElementById('widget-card');
        const titleEl = document.getElementById('title');
        const artistEl = document.getElementById('artist');
        const statusEl = document.getElementById('status');
        const pageLoadTime = Date.now();

        const firebaseConfig = {
            apiKey: "AIzaSyDDSJWWYCzwmM8DSIYI4w3vGPKSshpFhGk",
            authDomain: "yokoring-songbook.firebaseapp.com",
            databaseURL: "https://yokoring-songbook-default-rtdb.firebaseio.com",
            projectId: "yokoring-songbook"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('currentSong').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) updateWidget(data.title, data.artist);
            else resetToDefault();
        });

        db.ref('command').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.type === 'RELOAD' && data.timestamp > pageLoadTime) {
                location.reload(); 
            }
        });

        function updateWidget(title, artist) {
            card.style.opacity = "0";
            card.style.transform = "translateY(10px) scale(0.95)";
            setTimeout(() => {
                card.classList.remove('standby');
                statusEl.innerText = "NOW PLAYING ğŸµ";
                titleEl.innerText = title;
                artistEl.innerText = artist;
                titleEl.classList.remove('marquee');
                void titleEl.offsetWidth; 
                if (titleEl.scrollWidth > titleEl.parentElement.clientWidth) {
                    titleEl.classList.add('marquee');
                }
                card.style.opacity = "1";
                card.style.transform = "translateY(0) scale(1)";
            }, 500); 
        }

        function resetToDefault() {
            card.style.opacity = "0";
            setTimeout(() => {
                card.classList.add('standby');
                statusEl.innerText = "READY";
                titleEl.innerText = "ìš”ì½”ë§ ë…¸ë˜ì±…";
                artistEl.innerText = "YOKORING Player";
                titleEl.classList.remove('marquee');
                card.style.opacity = "1";
                card.style.transform = "translateY(0) scale(1)";
            }, 500);
        }
    </script>
</body>
</html>
