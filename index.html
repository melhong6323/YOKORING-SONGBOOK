<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>요코링 노래책</title>
<style>
  body { margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif; background:#0f1115; color:#eaeaf0;}
  .title-line {display:flex; align-items:center; justify-content:center; gap:16px; margin:24px 0 16px; font-size:28px; color:#eaeaf0;}
  .youtube-btn {display:flex; align-items:center; gap:6px; background:#ff4f9a; color:#000; font-weight:600; font-size:16px; padding:6px 12px; border-radius:8px; text-decoration:none; transition:transform .15s, background .15s;}
  .youtube-btn:hover {transform:scale(1.05); background:#ff78b2;}
  .container {max-width:1200px; margin:0 auto; padding:0 16px 40px; display:flex; gap:16px;}
  .left-ui {flex:1; display:flex; flex-direction:column; gap:12px;}
  .right-ui {flex:2; overflow-y:auto; max-height:80vh;}
  .guide {background:#181b22; border-radius:12px; padding:16px; font-size:14px; line-height:1.6; color:#cfd3ff;}
  #tabs {display:flex; gap:8px; flex-wrap:wrap;}
  .tab {padding:8px 14px; border-radius:20px; background:#1f2330; color:#cfd3ff; cursor:pointer; font-size:14px; user-select:none;}
  .tab.active {background:#ff4f9a; color:#000; font-weight:600;}
  .sort-controls {margin:4px 0 6px; display:flex;}
  .sort-btn {padding:6px 12px; border-radius:6px; background:#2a2e40; color:#fff; border:1px solid #555; font-size:13px; cursor:pointer; flex-shrink:0; transition:background .15s,color .15s;}
  .sort-btn:hover {background:#3a3f55; color:#ff4f9a;}
  #artistFilter {max-height:400px; overflow-y:auto;}
  .artist-list {display:flex; flex-wrap:wrap; gap:6px;}
  .artist {padding:6px 12px; border-radius:14px; background:#1f2330; font-size:13px; cursor:pointer; color:#cfd3ff;}
  .artist.active {background:#6c7bff; color:#000; font-weight:600;}
  .top-controls {display:flex; align-items:center; gap:8px; margin-bottom:12px; flex-wrap:wrap;}
  #searchInput {margin-left:auto; padding:6px 12px; border-radius:8px; border:none; font-size:14px; flex-shrink:0;}
  #toggleLargeText {margin-left:8px; padding:6px 12px; border-radius:6px; background:#ff4f9a; color:#000; border:none; cursor:pointer; font-size:14px; flex-shrink:0;}
  .list .song {display:grid; grid-template-columns:1.4fr 2fr auto auto auto auto auto; gap:8px; padding:12px 8px; border-bottom:1px solid #232736; align-items:center; font-size:15px; transition:background .2s, box-shadow .2s; cursor:pointer;}
  .song:hover {background:#1f2030;}
  .song strong {font-size:15.5px; font-weight:600; color:#fff;}
  .song > div {font-size:14.5px; color:#eaeaf0;}
  .song small {font-size:12.5px; color:#aab0ff;}
  .mr,.lyrics-btn {color:#ff4f9a; font-weight:bold; cursor:pointer; white-space:nowrap; font-size:14px;}
  .disabled {color:#555; pointer-events:none; font-weight:normal;}
  .song.selected {background:#1f2230; border-left:4px solid #ff4f9a; border-radius:6px; box-shadow:0 2px 10px rgba(255,79,154,0.3);}
  .song.selected strong {color:#ff4f9a; font-size:16px;}
  .song.selected div {color:#fff; font-weight:600;}
  .modal {display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:999;}
  .modal-content {background:#181b22; padding:30px 40px; max-width:600px; max-height:80%; overflow-y:auto; border-radius:12px; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); white-space:pre-wrap; border:2px solid #ff4f9a; box-shadow:0 0 20px rgba(255,79,154,0.4); cursor:grab; transition:transform .15s;}
  .modal-close {position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold; color:#ff4f9a;}
  #lyricsText {padding:14px 0; font-size:15.5px; line-height:1.75; letter-spacing:0.02em; color:#f1f2ff;}
  .broadcast-mode .song {font-size:21px;}
  @media (max-width:720px){.song {grid-template-columns:1fr 1.6fr auto auto auto;} .song .memo,.song .key{display:none;} #lyricsText{font-size:14.5px; line-height:1.8; padding:10px 12px;} #searchInput{flex-basis:100%; margin-left:0;}}
</style>
</head>
<body>
<h1 class="title-line">요코링 노래책
  <a href="https://www.youtube.com/@%EC%9A%94%EC%BD%94%EB%A7%81" target="_blank" class="youtube-btn">▶ 요코링 YouTube</a>
</h1>
<div class="container">
  <div class="left-ui">
    <div id="tabs"></div>
    <div class="sort-controls"><button id="sortAlpha" class="sort-btn">가나다순 ⇅</button></div>
    <div id="artistFilter" class="artist-filter"><div class="artist-list" id="artistList"></div></div>
    <div id="guide" class="guide"></div>
  </div>
  <div class="right-ui">
    <div class="top-controls">
      <input type="text" id="searchInput" placeholder="곡 검색">
      <button id="toggleLargeText">큰 글씨모드</button>
    </div>
    <div id="listWrapper"><div id="list" class="list"></div></div>
  </div>
</div>
<div id="lyricsModal" class="modal">
  <div class="modal-content">
    <span id="modalClose" class="modal-close">✕</span>
    <pre id="lyricsText"></pre>
  </div>
</div>

<script>
const SHEET_ID='1bSs04gJ8HyVil5PM0TBAm-4c_BeAqbU7ENMZ2AQcUVI';
const SHEET_NAMES=['사용설명서','K-POP','POP','J-POP','숙제곡','신곡'];
const guideEl=document.getElementById('guide');
const tabsEl=document.getElementById('tabs');
const listEl=document.getElementById('list');
const listWrapper=document.getElementById('listWrapper');
const artistFilterEl=document.getElementById('artistFilter');
const artistListEl=document.getElementById('artistList');
const lyricsModal=document.getElementById('lyricsModal');
const lyricsText=document.getElementById('lyricsText');
const modalClose=document.getElementById('modalClose');
const searchInput=document.getElementById('searchInput');
const toggleBtn=document.getElementById('toggleLargeText');
const modalContent=document.querySelector('.modal-content');
const sortAlphaBtn=document.getElementById('sortAlpha');

let currentSongs=[];
let currentArtist='전체';
let lyricsList=[];
let largeTextOn=false;
let selectedSongIndex=null;

/* 데이터 로드 */
async function fetchSheet(sheetName){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
  const res=await fetch(url);
  const text=await res.text();
  const json=JSON.parse(text.substring(47,text.length-2));
  return json.table.rows.map(r=>r.c.map(c=>c?c.v:''));
}
async function loadLyricsList(){
  const res=await fetch('data/lyrics_list.json');
  lyricsList=await res.json();
}
function findLyricsFile(artist,title){
  const found=lyricsList.find(l=>l.artist===artist && l.title===title);
  return found?found.file:null;
}
function normalizeArtist(name){return name.replace(/(\([^)]*feat[^)]*\))/i,'').replace(/feat.*$/i,'').trim();}

/* UI 렌더 */
function renderTabs(){SHEET_NAMES.slice(1).forEach(name=>{const tab=document.createElement('div'); tab.className='tab'; tab.textContent=name; tab.onclick=()=>selectCategory(name,tab); tabsEl.appendChild(tab);});}

async function loadGuide(){const rows=await fetchSheet('사용설명서'); guideEl.innerHTML=rows.map(r=>r.join(' ')).join('<br>');}

function renderArtistFilter(songs){
  const set=new Set(songs.map(s=>s.filterArtist));
  const artists=['전체',...Array.from(set).sort((a,b)=>songs.filter(s=>s.filterArtist===b).length - songs.filter(s=>s.filterArtist===a).length)];
  artistListEl.innerHTML='';
  artists.forEach(a=>{const btn=document.createElement('div'); btn.className='artist'+(a==='전체'?' active':''); btn.textContent=a; btn.onclick=()=>{if(currentArtist===a){currentArtist='전체';}else{currentArtist=a;} document.querySelectorAll('.artist').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.artist').forEach(x=>{if(x.textContent===currentArtist)x.classList.add('active');}); renderSongList(searchInput.value.toLowerCase()); const activeEl=[...document.querySelectorAll('.artist')].find(x=>x.textContent===currentArtist); if(activeEl)activeEl.scrollIntoView({behavior:"smooth",block:"center"});}; artistListEl.appendChild(btn);});
  artistFilterEl.style.display='block';
}

function renderSongList(searchQuery=''){
  listEl.innerHTML='';
  const filtered=currentSongs.filter(s=>(currentArtist==='전체'||s.filterArtist===currentArtist)&&(s.title.toLowerCase().includes(searchQuery)||s.artist.toLowerCase().includes(searchQuery)));
  filtered.forEach((s,index)=>{
    const div=document.createElement('div'); div.className='song';
    const mrBtn=s.mr?`<a class="mr" href="${s.mr}" target="_blank">MR</a>`:`<span class="mr disabled">MR</span>`;
    const lyricsBtn=s.lyricsFile?`<span class="lyrics-btn" onclick="showLyrics('${s.lyricsFile}')">가사</span>`:`<span class="lyrics-btn disabled">가사</span>`;
    div.innerHTML=`<strong>${s.artist}</strong><div>${s.title}</div><small class="memo">${s.memo||''}</small><small>${s.keyUp||''}</small><small class="key">${s.key||''}</small>${mrBtn}${lyricsBtn}`;
    div.onclick=()=>{document.querySelectorAll('.song').forEach(s=>s.classList.remove('selected')); div.classList.add('selected'); selectedSongIndex=index; const rect=div.getBoundingClientRect(); if(rect.top<0||rect.bottom>window.innerHeight){div.scrollIntoView({behavior:"smooth",block:"center"});}};
    listEl.appendChild(div);
  });
}

/* 가사 모달 */
function showLyrics(file){fetch(`data/lyrics/${file}`).then(res=>res.text()).then(text=>{lyricsText.textContent=text; lyricsModal.style.display='flex';}).catch(()=>{lyricsText.textContent='가사를 불러올 수 없습니다.'; lyricsModal.style.display='flex';});}
modalClose.onclick=()=>lyricsModal.style.display='none';
lyricsModal.onclick=e=>{if(e.target===lyricsModal)lyricsModal.style.display='none';};

/* 검색 */
searchInput.addEventListener('input',()=>{renderSongList(searchInput.value.toLowerCase());});

/* 큰 글씨모드 */
toggleBtn.onclick=()=>{
  largeTextOn=!largeTextOn;
  listWrapper.classList.toggle('broadcast-mode',largeTextOn);
};

/* 카테고리 선택 */
async function selectCategory(name,tabEl){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); tabEl.classList.add('active');
  listEl.style.display='block'; artistFilterEl.style.display='none'; currentArtist='전체'; currentSongs=[];
  const rows=await fetchSheet(name);
  rows.forEach(r=>{if(!r[0]||!r[1])return; currentSongs.push({artist:r[0], filterArtist:normalizeArtist(r[0]), title:r[1], memo:r[2], keyUp:r[3], key:r[4], mr:r[5], lyricsFile:findLyricsFile(r[0],r[1])});});
  renderArtistFilter(currentSongs);
  renderSongList(searchInput.value.toLowerCase());
}

/* 가나다순 버튼 모달 */
sortAlphaBtn.onclick=async ()=>{
  const rows=await fetchSheet(document.querySelector('.tab.active').textContent);
  const set=new Set(rows.map(r=>normalizeArtist(r[0])));
  const sorted=Array.from(set).sort();
  const modal=lyricsModal;
  lyricsText.textContent=''; modal.style.display='flex';
  sorted.forEach(a=>{const div=document.createElement('div'); div.textContent=a; div.style.padding='6px 12px'; div.style.cursor='pointer'; div.style.borderBottom='1px solid #333';
  div.onclick=()=>{currentArtist=a; renderSongList(searchInput.value.toLowerCase()); document.querySelectorAll('.artist').forEach(x=>x.classList.remove('active')); [...document.querySelectorAll('.artist')].find(x=>x.textContent===a)?.classList.add('active'); modal.style.display='none';}; lyricsText.appendChild(div);});
};
(async()=>{
  await loadLyricsList();
  renderTabs();
  loadGuide();
})();
</script>
</body>
</html>
